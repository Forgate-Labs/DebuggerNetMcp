---
phase: 09-tests-documentation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - README.md
autonomous: true
requirements:
  - DOCS-01

must_haves:
  truths:
    - "README describes the C#/ICorDebug architecture, not Python/netcoredbg"
    - "A new contributor can find prerequisites (libdbgshim.so location, DBGSHIM_PATH env var) in the README"
    - "README shows build.sh and install.sh steps to get the server running"
    - "README includes usage examples for all 15 tools (14 original + debug_launch_test)"
    - "README contains an ASCII architecture diagram"
    - "README includes a troubleshooting section addressing the libdbgshim.so search path gap"
  artifacts:
    - path: "README.md"
      provides: "Complete project documentation for new contributors"
      contains: "libdbgshim"
  key_links:
    - from: "README.md prerequisites section"
      to: "~/.local/bin/libdbgshim.so"
      via: "DBGSHIM_PATH environment variable documentation"
      pattern: "DBGSHIM_PATH"
    - from: "README.md tools section"
      to: "debug_launch_test"
      via: "15 tools listed with usage examples"
      pattern: "debug_launch_test"
---

<objective>
Rewrite README.md completely — replace the stale Python/netcoredbg documentation with accurate C#/ICorDebug content (DOCS-01).

Purpose: The current README describes a Python architecture that no longer exists. A new contributor reading it would try to install Python, uv, and netcoredbg — all of which are irrelevant. The new README must be self-contained: prerequisites, build steps, install steps, architecture, and complete tool reference.

Output:
- `README.md` — full rewrite with ASCII diagram, prerequisites, build/install, 15 tool examples, troubleshooting
</objective>

<execution_context>
@/home/eduardo/.claude/get-shit-done/workflows/execute-plan.md
@/home/eduardo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-tests-documentation/09-RESEARCH.md

@src/DebuggerNetMcp.Mcp/DebuggerTools.cs
@build.sh
@install.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite README.md with architecture, prerequisites, build/install, tools reference</name>
  <files>
    README.md
  </files>
  <action>
    Read the current README.md and the following source files before writing:
    - `src/DebuggerNetMcp.Mcp/DebuggerTools.cs` — get the exact 15 tool names and their `[Description]` attributes
    - `build.sh` — confirm exact build commands
    - `install.sh` — confirm exact install commands
    - `debugger-net-mcp.sh` — the wrapper script (strace workaround)

    Write a new README.md with these sections IN ORDER:

    **1. Title + one-line description**
    ```
    # DebuggerNetMcp

    MCP server for interactive .NET debugging via ICorDebug — works on Linux kernel 6.12+ without fragile workarounds.
    ```

    **2. Architecture section** with the ASCII diagram from the research file:
    ```
    ## Architecture

    ┌─────────────────────────────────────────────────────────────────┐
    │                        Claude Code (LLM)                         │
    └───────────────────────────┬─────────────────────────────────────┘
                                │ MCP stdio (JSON-RPC)
    ┌───────────────────────────▼─────────────────────────────────────┐
    │               DebuggerNetMcp.Mcp (MCP Server)                    │
    │  DebuggerTools.cs — 15 [McpServerTool] methods                   │
    └───────────────────────────┬─────────────────────────────────────┘
                                │ C# method calls
    ┌───────────────────────────▼─────────────────────────────────────┐
    │             DebuggerNetMcp.Core (Debug Engine)                   │
    │  DotnetDebugger.cs — ICorDebug dispatch thread + event channel   │
    │  PdbReader.cs      — Portable PDB source mapping                 │
    │  VariableReader.cs — ICorDebugValue recursive inspection         │
    └───────────┬──────────────────────────────────────────┬──────────┘
                │ P/Invoke                                  │ COM
    ┌───────────▼──────────┐                  ┌────────────▼──────────┐
    │  libdbgshim.so       │                  │  ICorDebug (COM)       │
    │  (DbgShim 10.0.x)    │                  │  ManagedCallbackHandler│
    └──────────────────────┘                  └────────────┬──────────┘
                                                           │ ICorDebug API
                                              ┌────────────▼──────────┐
                                              │   .NET Process         │
                                              │   (debuggee)           │
                                              └───────────────────────┘
    ```

    **3. Prerequisites section** — be specific and accurate:
    - .NET SDK 10.0 (check global.json — `dotnet --version`)
    - `libdbgshim.so` from NuGet package `Microsoft.Diagnostics.DbgShim.linux-x64` (version 10.x or 9.x stable)
    - Linux (kernel 6.12+ supported via strace workaround in the wrapper script)
    - `strace` — `sudo apt install strace` (required for kernel >= 6.12 workaround)

    **4. Installing libdbgshim.so subsection** — this is critical:
    ```
    ### Installing libdbgshim.so

    libdbgshim.so was removed from the .NET 7+ runtime and is now distributed as a separate NuGet package.

    **Option A: Download from NuGet (stable, .NET 9):**
    ```bash
    # Download the stable 9.x package
    dotnet tool install --global dotnet-dump  # ensures NuGet cache is initialized
    mkdir -p /tmp/dbgshim && cd /tmp/dbgshim
    dotnet new console -n tmp --no-restore
    cd tmp
    dotnet add package Microsoft.Diagnostics.DbgShim --version 9.0.*
    cp ~/.nuget/packages/microsoft.diagnostics.dbgshim/*/runtimes/linux-x64/native/libdbgshim.so ~/.local/bin/
    ```

    **Option B: Download nightly (for .NET 10 preview):**
    The nightly feed is: https://pkgs.dev.azure.com/dnceng/public/_packaging/dotnet-tools/nuget/v3/flat2
    Package: `Microsoft.Diagnostics.DbgShim.linux-x64`

    **After installing, set the environment variable:**
    ```bash
    export DBGSHIM_PATH=~/.local/bin/libdbgshim.so
    # Add to ~/.bashrc or ~/.zshrc for persistence
    ```

    Note: `~/.local/bin/` is NOT in the default libdbgshim.so search path. You must set `DBGSHIM_PATH`
    or the server will fail to load with a `DllNotFoundException`.
    ```

    **5. Build section:**
    ```
    ## Build

    ```bash
    ./build.sh
    ```

    This compiles:
    - Native ptrace wrapper (`libdotnetdbg.so`) via CMake
    - `DebuggerNetMcp.Core` and `DebuggerNetMcp.Mcp` in Release mode

    The Release binary is at: `src/DebuggerNetMcp.Mcp/bin/Release/net10.0/DebuggerNetMcp.Mcp`
    ```

    **6. Install section:**
    ```
    ## Install

    ```bash
    ./install.sh
    ```

    Registers the MCP server in Claude Code as `debugger-net` via `claude mcp add`.
    The wrapper script (`debugger-net-mcp.sh`) applies the `strace -f -e trace=none` workaround
    required for Linux kernel >= 6.12 compatibility.

    **Prerequisites for install:**
    - `DBGSHIM_PATH` env var must be set (see above)
    - `claude` CLI must be in PATH
    ```

    **7. Tools Reference section** — list all 15 tools with their purpose and a brief usage example.
    Read `DebuggerTools.cs` to get exact tool names and descriptions. Format as:

    ```
    ## Tools

    ### `debug_launch`
    Launch a .NET project in debug mode. The process stops at entry (CreateProcess) — call `debug_continue` after setting breakpoints.

    **Parameters:** `projectPath` (string), `appDllPath` (string), `firstChanceExceptions` (bool, optional)

    ### `debug_attach`
    Attach to a running .NET process by PID.

    **Parameters:** `processId` (number)

    ### `debug_launch_test`
    Launch an xUnit test project in debug mode via `dotnet test`. Attaches to the testhost process.

    **Parameters:** `projectPath` (string), `filter` (string, optional)

    [... continue for all 15 tools ...]
    ```

    List all 15 tools: debug_launch, debug_attach, debug_launch_test, debug_set_breakpoint,
    debug_remove_breakpoint, debug_continue, debug_step_over, debug_step_into, debug_step_out,
    debug_variables, debug_evaluate, debug_stacktrace, debug_pause, debug_disconnect, debug_status.

    **8. Typical debug session example:**
    Show a complete example Claude Code workflow from launch to exit. Use a short numbered list showing
    the sequence of tool calls a user would make to set a breakpoint and inspect a variable.

    **9. Running tests section:**
    ```
    ## Running Tests

    ```bash
    dotnet test
    ```

    The test suite includes:
    - **PdbReaderTests** — unit tests for PDB forward/reverse lookup
    - **DebuggerIntegrationTests** — end-to-end: launch, breakpoint, inspect, step, exit
    - **DebuggerAdvancedTests** — exceptions, multi-thread inspection, process attach

    Set `DBGSHIM_PATH` before running integration tests (same requirement as the server).
    ```

    **10. Troubleshooting section:**
    ```
    ## Troubleshooting

    ### `DllNotFoundException: libdbgshim.so`
    The server cannot find libdbgshim.so. Set `DBGSHIM_PATH`:
    ```bash
    export DBGSHIM_PATH=~/.local/bin/libdbgshim.so
    ```
    The search path does NOT include `~/.local/bin/` by default.

    ### Server crashes on Linux kernel >= 6.12
    The wrapper script (`debugger-net-mcp.sh`) applies the `strace -f -e trace=none -o /dev/null` workaround.
    If you're running the binary directly (not via Claude Code), prefix with strace:
    ```bash
    strace -f -e trace=none -o /dev/null ./DebuggerNetMcp.Mcp
    ```

    ### Tests hang indefinitely
    Integration tests use 30-second timeouts via `CancellationTokenSource`. If a test hangs,
    ensure `DBGSHIM_PATH` is set — a missing libdbgshim.so causes silent initialization failure.

    ### `debug_launch_test` doesn't hit breakpoints
    Ensure the xUnit project is built in Debug mode first: `dotnet build -c Debug`.
    The VSTEST_HOST_DEBUG=1 mechanism requires the testhost process to wait for a debugger attach.
    ```

    **Writing rules:**
    - Do NOT include any Python, uv, netcoredbg, DAP, or PTRACE_ATTACH references
    - Version references: .NET 10, ServerVersion 0.9.0
    - Keep the README practical — a contributor should be able to follow it top-to-bottom and have a working setup
    - Use code blocks with language tags (bash, csharp, xml) for syntax highlighting
    - Do NOT use emojis
  </action>
  <verify>
    1. Read README.md and confirm all required sections are present.
    2. `grep -c "netcoredbg\|Python\|uv run\|DAP protocol" README.md` → should return 0.
    3. `grep "DBGSHIM_PATH" README.md` → should return at least 3 occurrences.
    4. `grep "debug_launch_test" README.md` → should return at least 1 occurrence (in tools section).
    5. `grep "libdbgshim" README.md` → should return at least 5 occurrences (prerequisites + install + troubleshooting).
  </verify>
  <done>
    README.md completely rewritten with:
    - ASCII architecture diagram (Claude Code → MCP → Core → libdbgshim.so + ICorDebug → .NET Process)
    - Prerequisites section with libdbgshim.so install instructions and DBGSHIM_PATH requirement
    - Build and install instructions using build.sh and install.sh
    - All 15 tools documented with parameters and brief descriptions
    - Typical debug session workflow example
    - Running tests section
    - Troubleshooting section addressing the 4 most common failure modes
    - Zero Python/netcoredbg/DAP references
  </done>
</task>

</tasks>

<verification>
```bash
grep -c "netcoredbg\|Python\|uv run" README.md  # must be 0
grep -c "debug_launch_test\|DBGSHIM_PATH\|libdbgshim" README.md  # must be >= 5
wc -l README.md  # expected: 150-250 lines for a comprehensive but focused README
```
</verification>

<success_criteria>
1. README.md contains zero references to Python, netcoredbg, DAP protocol, or uv.
2. README.md contains the ASCII architecture diagram.
3. README.md documents DBGSHIM_PATH environment variable with explanation of why ~/.local/bin/ is not in the default search path.
4. README.md documents all 15 tools with parameter lists.
5. README.md contains a troubleshooting section with the strace workaround and DllNotFoundException fix.
6. A new contributor can read the README top-to-bottom and have a working server setup.
</success_criteria>

<output>
After completion, create `.planning/phases/09-tests-documentation/09-03-SUMMARY.md`
</output>
