---
phase: 10-corrija-os-debitos-tecnicos-todos-que-ficaram-em-aberto
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - debugger-net-mcp.sh
  - install.sh
  - build.sh
  - .planning/v1.1-MILESTONE-AUDIT.md
  - .planning/phases/05-type-system/05-02-SUMMARY.md
autonomous: true
requirements:
  - INFRA-04
  - INFRA-05
  - NATIVE-01
  - NATIVE-02

must_haves:
  truths:
    - "debugger-net-mcp.sh is committed to git and uses SCRIPT_DIR for portability (no hardcoded /home/eduardo paths)"
    - "install.sh registers the strace wrapper script, not dotnet run directly"
    - "build.sh builds only the managed solution — no CMake step"
    - "native/ directory and lib/libdotnetdbg.so are removed from the repo"
    - "v1.1-MILESTONE-AUDIT.md is committed to git"
    - "05-02-SUMMARY.md frontmatter lists TYPE-04 in requirements-completed"
  artifacts:
    - path: "debugger-net-mcp.sh"
      provides: "Portable strace wrapper using SCRIPT_DIR"
      contains: "SCRIPT_DIR"
    - path: "install.sh"
      provides: "Registers wrapper script via claude mcp add"
      contains: "debugger-net-mcp.sh"
    - path: "build.sh"
      provides: "Dotnet-only build without CMake"
    - path: ".planning/phases/05-type-system/05-02-SUMMARY.md"
      provides: "Correct frontmatter with TYPE-04"
      contains: "TYPE-04"
  key_links:
    - from: "install.sh"
      to: "debugger-net-mcp.sh"
      via: "claude mcp add registers wrapper script path"
      pattern: "debugger-net-mcp\\.sh"
    - from: "debugger-net-mcp.sh"
      to: "src/DebuggerNetMcp.Mcp/bin/Release/net10.0/DebuggerNetMcp.Mcp"
      via: "SCRIPT_DIR-relative binary path"
      pattern: "SCRIPT_DIR"
---

<objective>
Resolve all repo hygiene, build system, and documentation debt from v1.1.

Purpose: The project has 2 untracked files, a broken install.sh/wrapper inconsistency, a dead CMake/native build that runs on every `build.sh`, and a minor SUMMARY frontmatter omission. These create confusion, slow builds, and break kernel 6.12+ installs for any user who runs install.sh without knowing to manually run the wrapper.

Output: Committed wrapper script (portable), install.sh that registers the wrapper, build.sh without CMake, native/ and lib/ removed from repo, v1.1-MILESTONE-AUDIT.md committed, 05-02-SUMMARY.md frontmatter corrected.
</objective>

<execution_context>
@/home/eduardo/.claude/get-shit-done/workflows/execute-plan.md
@/home/eduardo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-corrija-os-debitos-tecnicos-todos-que-ficaram-em-aberto/10-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix debugger-net-mcp.sh portability and commit untracked files</name>
  <files>debugger-net-mcp.sh</files>
  <action>
Rewrite `debugger-net-mcp.sh` to use `$SCRIPT_DIR` for the binary path instead of the hardcoded `/home/eduardo/Projects/DebuggerNetMcp/...` path.

New content for `debugger-net-mcp.sh`:
```bash
#!/bin/bash
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
export DOTNET_ROOT="${DOTNET_ROOT:-${HOME}/.dotnet}"
exec strace -f -e trace=none -o /dev/null \
  "$SCRIPT_DIR/src/DebuggerNetMcp.Mcp/bin/Release/net10.0/DebuggerNetMcp.Mcp" \
  2>>/tmp/debugger-net-mcp.log "$@"
```

Key changes:
- Add `SCRIPT_DIR` computation using `BASH_SOURCE[0]` (same pattern as build.sh and install.sh)
- Replace hardcoded absolute path with `$SCRIPT_DIR/src/DebuggerNetMcp.Mcp/bin/Release/net10.0/DebuggerNetMcp.Mcp`
- Add `export DOTNET_ROOT` with fallback so the binary can find the .NET runtime when spawned by Claude
- Keep strace flags, log redirection, and `"$@"` passthrough unchanged

Then commit all currently untracked files:
```bash
git add debugger-net-mcp.sh
git add .planning/v1.1-MILESTONE-AUDIT.md
git commit -m "chore(10-01): commit untracked wrapper script and milestone audit"
```
  </action>
  <verify>
Run: `git status` — should show `debugger-net-mcp.sh` and `.planning/v1.1-MILESTONE-AUDIT.md` as tracked (not in untracked list)
Run: `grep SCRIPT_DIR debugger-net-mcp.sh` — should show the SCRIPT_DIR line
Run: `grep /home/eduardo debugger-net-mcp.sh` — should return no results
  </verify>
  <done>Both files are committed. The wrapper script has no hardcoded user-specific paths — it resolves the binary relative to its own directory using SCRIPT_DIR.</done>
</task>

<task type="auto">
  <name>Task 2: Update install.sh to register strace wrapper + remove dead native library</name>
  <files>install.sh, build.sh</files>
  <action>
**Part A — Update install.sh to register the strace wrapper instead of dotnet run:**

Replace the `claude mcp add` call in `install.sh` with one that registers `debugger-net-mcp.sh`. The wrapper handles DOTNET_ROOT, logging, and strace — the env var passthrough from install.sh is no longer needed.

New `claude mcp add` block (replace everything from the existing `"$CLAUDE_BIN" mcp add` down to the closing line):
```bash
"$CLAUDE_BIN" mcp add \
    -s user \
    -- \
    debugger-net \
    "$SCRIPT_DIR/debugger-net-mcp.sh"
```

Remove the `-e DOTNET_ROOT=...` and `-e LD_LIBRARY_PATH=...` flags. Keep the remove-before-add idempotency pattern at the top of the file unchanged.

**Part B — Remove dead native library from build.sh:**

Remove the CMake block from `build.sh` (lines 6-8):
```
echo "==> Building native library (CMake)..."
cmake -S "$SCRIPT_DIR/native" -B "$SCRIPT_DIR/native/build" -DCMAKE_BUILD_TYPE=Release
cmake --build "$SCRIPT_DIR/native/build" --parallel
```

Also remove the output echo referencing the native library:
```
echo "    Native: $SCRIPT_DIR/lib/libdotnetdbg.so"
```

The resulting build.sh should only build the managed solution via `dotnet build`.

**Part C — Remove dead native artifacts from the repository:**

The `native/` directory (CMake project, `ptrace_wrapper.c`) and `lib/libdotnetdbg.so` are dead code — the ICorDebug/libdbgshim approach replaced this entirely in Phase 3.

Run:
```bash
git rm -r native/
git rm lib/libdotnetdbg.so
```

The `lib/` directory will be empty after removing `libdotnetdbg.so` — confirm with `ls lib/` before removing it. If empty, run `rmdir lib/` and `git rm -r lib/` if git still tracks it.

Then commit everything:
```bash
git add install.sh build.sh
git commit -m "chore(10-01): remove dead native lib, fix install.sh to use strace wrapper"
```
  </action>
  <verify>
Run: `grep -i cmake build.sh` — should return no results
Run: `grep "dotnet run" install.sh` — should return no results
Run: `grep "debugger-net-mcp.sh" install.sh` — should return a match
Run: `ls native/ 2>/dev/null && echo EXISTS || echo REMOVED` — should print REMOVED
Run: `ls lib/ 2>/dev/null && echo EXISTS || echo REMOVED` — should print REMOVED
Run: `./build.sh 2>&1 | tail -5` — should complete successfully building only the managed solution
  </verify>
  <done>build.sh builds only via `dotnet build`. install.sh registers the strace wrapper. The native/ and lib/ directories are gone from the repo. All changes committed.</done>
</task>

<task type="auto">
  <name>Task 3: Fix TYPE-04 frontmatter in 05-02-SUMMARY.md</name>
  <files>.planning/phases/05-type-system/05-02-SUMMARY.md</files>
  <action>
Read `.planning/phases/05-type-system/05-02-SUMMARY.md`. Find the `requirements-completed` field in the frontmatter. Add `TYPE-04` to the list if it is missing.

The requirement TYPE-04 ("Debugger pode ler static fields de uma classe via debug_variables ou debug_evaluate") was implemented in Plan 05-02 (ICorDebugClass.GetStaticFieldValue + GetLocalsAsync/EvaluateAsync) but was not recorded in the SUMMARY frontmatter.

After editing, commit:
```bash
git add .planning/phases/05-type-system/05-02-SUMMARY.md
git commit -m "docs(10-01): add TYPE-04 to 05-02-SUMMARY requirements-completed"
```
  </action>
  <verify>
Run: `grep "TYPE-04" .planning/phases/05-type-system/05-02-SUMMARY.md` — should return a match in the frontmatter
  </verify>
  <done>05-02-SUMMARY.md frontmatter contains TYPE-04 in requirements-completed. Committed.</done>
</task>

</tasks>

<verification>
1. `git status` shows no untracked files that belong to the project (debugger-net-mcp.sh, v1.1-MILESTONE-AUDIT.md both tracked)
2. `cat debugger-net-mcp.sh` — contains SCRIPT_DIR, no hardcoded /home/eduardo paths
3. `cat install.sh` — registers debugger-net-mcp.sh, no `dotnet run` in the mcp add command
4. `grep -i cmake build.sh` — no results
5. `ls native/ 2>/dev/null || echo gone` — prints "gone"
6. `ls lib/ 2>/dev/null || echo gone` — prints "gone"
7. `grep TYPE-04 .planning/phases/05-type-system/05-02-SUMMARY.md` — matches
8. `./build.sh 2>&1 | tail -3` — completes without error (managed build only)
</verification>

<success_criteria>
- All 2 untracked project files are committed to git
- install.sh registers strace wrapper (kernel 6.12+ compatible out-of-the-box)
- debugger-net-mcp.sh is portable (SCRIPT_DIR, no hardcoded paths)
- build.sh runs only `dotnet build` — CMake removed
- native/ and lib/ directories removed from repo
- 05-02-SUMMARY.md frontmatter contains TYPE-04
</success_criteria>

<output>
After completion, create `.planning/phases/10-corrija-os-debitos-tecnicos-todos-que-ficaram-em-aberto/10-01-SUMMARY.md`
</output>
