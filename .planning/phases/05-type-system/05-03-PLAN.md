---
phase: 05-type-system
plan: "03"
type: execute
wave: 2
depends_on:
  - "05-01"
  - "05-02"
files_modified:
  - tests/HelloDebug/Program.cs
autonomous: false
requirements:
  - TYPE-01

must_haves:
  truths:
    - "debug_variables at a struct breakpoint returns struct fields with correct types and values"
    - "debug_variables on an enum var returns 'EnumName.MemberName'"
    - "debug_variables on Nullable<T> HasValue=true returns the underlying value"
    - "debug_variables on Nullable<T> HasValue=false returns 'null'"
    - "debug_variables or debug_evaluate returns a static field value"
  artifacts:
    - path: "tests/HelloDebug/Program.cs"
      provides: "Sections 13-16: struct, enum, Nullable, static field test scenarios"
      contains: "SECTION 13"
  key_links:
    - from: "tests/HelloDebug/Program.cs section 13 (struct breakpoint)"
      to: "VariableReader.ReadObjectFields (struct path)"
      via: "ICorDebugObjectValue cast for ValueType"
      pattern: "struct"
    - from: "tests/HelloDebug/Program.cs section 14 (enum)"
      to: "VariableReader.IsEnumType + ReadEnumValue"
      via: "CorElementType.ValueType dispatch"
      pattern: "enum"
---

<objective>
Add HelloDebug test sections 13-16 covering struct, enum, Nullable&lt;T&gt;, and static field scenarios. Then perform a live debug session verification to confirm all four TYPE requirements work end-to-end.

Purpose: The implementations from Plans 01 and 02 need real test targets in HelloDebug. Once sections are in place, run the MCP server and exercise each new type with debug_variables and debug_evaluate to verify correctness.

Output: HelloDebug gains 4 new annotated sections. A live debug session validates all TYPE-01..04 success criteria.
</objective>

<execution_context>
@/home/eduardo/.claude/get-shit-done/workflows/execute-plan.md
@/home/eduardo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@tests/HelloDebug/Program.cs
@.planning/phases/05-type-system/05-01-SUMMARY.md
@.planning/phases/05-type-system/05-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add HelloDebug sections 13-16 (struct, enum, Nullable, static)</name>
  <files>tests/HelloDebug/Program.cs</files>
  <action>
Append four new sections after the existing section 12 (evalTarget line) and before "Session complete". Also add the supporting type definitions after the existing types (Address, Person, Node).

**Section 13 — Struct:**
```csharp
// ─── SECTION 13: Struct ──────────────────────────────────────────────────────
// BP-13: Breakpoint here. Inspect 'pt' — a struct with X and Y fields.
// Expected: type="Point", X=3, Y=4 as children.
var pt = new Point(3, 4);
double dist = pt.Distance();
Console.WriteLine($"[13] Struct: Point({pt.X},{pt.Y}), distance={dist:F2}");  // <── BP-13
```

**Section 14 — Enum:**
```csharp
// ─── SECTION 14: Enum ────────────────────────────────────────────────────────
// BP-14: Breakpoint here. Inspect 'day', 'season', and 'priority'.
// Expected: day="DayOfWeek.Wednesday", season="Season.Summer", priority="Priority.High"
var day = DayOfWeek.Wednesday;    // System enum
var season = Season.Summer;       // User-defined enum
var priority = Priority.High;     // Underlying int = 2
Console.WriteLine($"[14] Enum: day={day}, season={season}, priority={priority}");  // <── BP-14
```

**Section 15 — Nullable&lt;T&gt;:**
```csharp
// ─── SECTION 15: Nullable ────────────────────────────────────────────────────
// BP-15: Breakpoint here. Inspect 'withValue' and 'withoutValue'.
// Expected: withValue=42 (unwrapped int), withoutValue="null"
int? withValue = 42;
int? withoutValue = null;
double? withDouble = 3.14;
Console.WriteLine($"[15] Nullable: withValue={withValue}, withoutValue={withoutValue is null}");  // <── BP-15
```

**Section 16 — Static fields:**
```csharp
// ─── SECTION 16: Static fields ───────────────────────────────────────────────
// BP-16: Breakpoint here. Use debug_evaluate("AppConfig.MaxRetries") and
// debug_evaluate("AppConfig.Version") to read static fields.
// After mutation: MaxRetries=5, Version="1.0.0"
AppConfig.MaxRetries = 5;  // mutate to verify we read current value, not compile-time constant
Console.WriteLine($"[16] Static: MaxRetries={AppConfig.MaxRetries}, Version={AppConfig.Version}");  // <── BP-16
```

**New type definitions** (append after the Node class):
```csharp
// Section 13: struct
struct Point(int X, int Y)
{
    public int X { get; } = X;
    public int Y { get; } = Y;
    public double Distance() => Math.Sqrt(X * X + Y * Y);
}

// Section 14: user enum types
enum Season { Spring, Summer, Autumn, Winter }
enum Priority { Low = 1, High = 2, Critical = 3 }

// Section 16: static fields
static class AppConfig
{
    public static int MaxRetries = 3;
    public static readonly string Version = "1.0.0";
}
```

Note: `DayOfWeek` is a built-in System enum — no definition needed. Rebuild HelloDebug after editing:
`dotnet build tests/HelloDebug/ -c Debug`
  </action>
  <verify>dotnet build tests/HelloDebug/ -c Debug 2>&amp;1 | tail -5</verify>
  <done>HelloDebug builds with 0 errors. Sections 13-16 exist with BP markers. Types Point (struct), Season, Priority, AppConfig are defined.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Live debug session — verify all TYPE-01..04 requirements</name>
  <action>
Build the Release binary before running the verification session:
`dotnet build src/DebuggerNetMcp.Mcp/ -c Release`

Then run the debug session as described in how-to-verify.
  </action>
  <what-built>
Plans 01 and 02 implemented: VariableReader now detects enums (IsEnumType/ReadEnumValue), Nullable&lt;T&gt; (ReadNullableValue), and struct fields via ReadObjectFields. DotnetDebugger extends GetLocalsAsync with static fields and EvaluateAsync with "TypeName.FieldName" dot notation. HelloDebug has sections 13-16.
  </what-built>
  <how-to-verify>
Run a debug session against HelloDebug using the debugger-net MCP server:

**Setup:**
```
debug_launch(projectPath="tests/HelloDebug")
debug_set_breakpoint(file="Program.cs", line=&lt;BP-13 line number&gt;)
debug_set_breakpoint(file="Program.cs", line=&lt;BP-14 line number&gt;)
debug_set_breakpoint(file="Program.cs", line=&lt;BP-15 line number&gt;)
debug_set_breakpoint(file="Program.cs", line=&lt;BP-16 line number&gt;)
debug_continue()
```

**Verify TYPE-01 (struct) at BP-13:**
`debug_variables()` — Expected: `pt` appears with type "Point" and children X=3, Y=4.

**Verify TYPE-02 (enum) at BP-14:**
`debug_variables()` — Expected: `day`="DayOfWeek.Wednesday", `season`="Season.Summer", `priority`="Priority.High".

**Verify TYPE-03 (Nullable) at BP-15:**
`debug_variables()` — Expected: `withValue`="42" (unwrapped int), `withoutValue`="null".

**Verify TYPE-04 (static field) at BP-16:**
```
debug_evaluate("AppConfig.MaxRetries")  — Expected: "5" (mutated value)
debug_evaluate("AppConfig.Version")    — Expected: "1.0.0"
```
  </how-to-verify>
  <verify>Human confirms all four type scenarios return correct values</verify>
  <done>All four TYPE-01..04 success criteria confirmed: struct shows fields, enum shows "Name.Member", Nullable unwraps or shows "null", static field returns current value.</done>
  <resume-signal>Type "approved" if all pass, or describe failures with the actual debug_variables/debug_evaluate output</resume-signal>
</task>

</tasks>

<verification>
1. HelloDebug builds: `dotnet build tests/HelloDebug/ -c Debug` exits 0
2. Sections 13-16 present: `grep -n "SECTION 13\|SECTION 14\|SECTION 15\|SECTION 16" tests/HelloDebug/Program.cs`
3. Type definitions present: `grep -n "struct Point\|enum Season\|enum Priority\|AppConfig" tests/HelloDebug/Program.cs`
4. Release binary built: `dotnet build src/DebuggerNetMcp.Mcp/ -c Release` exits 0
5. Human verification of live debug session passes (checkpoint gate)
</verification>

<success_criteria>
- HelloDebug compiles with sections 13-16
- Live debug session confirms:
  1. TYPE-01: struct Point shows X=3, Y=4 as children in debug_variables
  2. TYPE-02: enum vars show "EnumName.MemberName" format
  3. TYPE-03: Nullable with value shows integer, Nullable null shows "null"
  4. TYPE-04: debug_evaluate("AppConfig.MaxRetries") returns "5" (mutated value)
- All TYPE-01..04 requirements verified by human
</success_criteria>

<output>
After completion, create `.planning/phases/05-type-system/05-03-SUMMARY.md`
</output>
